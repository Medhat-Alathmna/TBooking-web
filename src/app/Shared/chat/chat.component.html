<!-- ðŸ”˜ Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¹Ø§Ø¦Ù… -->
<p-button
  icon="pi pi-comments"
  class="p-button-rounded p-button-lg p-button-info chat-float-btn"
  (click)="visible = true"
  pTooltip="Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ"
  tooltipPosition="left"
></p-button>

<!-- ðŸ’¬ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
<p-dialog
  [(visible)]="visible"
  [modal]="false"
  [draggable]="true"
  [resizable]="false"
  [style]="{ width: '400px', height: '500px' }"
  position="bottom-right"
  [baseZIndex]="10000"
  [dismissableMask]="true"
  [showHeader]="false"
>
  <!-- ðŸ§  ØªØ±ÙˆÙŠØ³Ø© -->
  <div class="assistant-header">
    <div class="assistant-header-left">
      <img src="assets/images/TS.png" alt="logo" class="assistant-logo" />
      <div>
        <h3 class="assistant-title">TBooking AI Assistant</h3>
        <!-- <small class="assistant-sub">Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</small> -->
      </div>
    </div>
    <button
      pButton
      icon="pi pi-times"
      class="p-button-rounded p-button-text p-button-danger"
      (click)="visible = false"
    ></button>
  </div>

  <!-- ðŸ’¬ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
  <div class="chat-dialog">
    <div class="chat-messages">
      <div
        *ngFor="let msg of messages"
        class="chat-message"
        [ngClass]="msg.role"
      >
        <div class="bubble">
          <i
            *ngIf="msg.role === 'assistant'"
            class="pi pi-robot"
            style="margin-right: 6px"
          ></i>
          <i
            *ngIf="msg.role === 'user'"
            class="pi pi-user"
            style="margin-left: 6px"
          ></i>
          <span>{{ msg.text }}</span>
        </div>
      </div>

      <div *ngIf="loading" class="loading">
        <i class="pi pi-spin pi-spinner"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...
      </div>
    </div>

    <!-- ðŸ“ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
    <div class="chat-input">
      <textarea
        pInputTextarea
        [(ngModel)]="message"
        rows="2"
        placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."
        (keydown.enter)="sendMessage()"
      ></textarea>
      <button
        pButton
        icon="pi pi-send"
        class="p-button-rounded p-button-success"
        (click)="sendMessage()"
      ></button>
    </div>
  </div>
</p-dialog>


<p-dialog
  header="{{ dashboardData?.title || 'Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' }}"
  [(visible)]="showDashboard"
  modal="true"
  [style]="{ width: '90vw', height: '80vh' }"
  [resizable]="false"
  (onHide)="closeDashboard()"
>
  <app-ai-dashboard
    *ngIf="showDashboard"
    [data]="dashboardData"
  ></app-ai-dashboard>
</p-dialog>