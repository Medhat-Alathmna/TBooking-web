<app-loading *ngIf="loading" display="full"></app-loading>

<div class="grid card h-full">
    <p-table #kt [value]="products" 
    [paginator]="true" [rows]='rowNum' currentPageReportTemplate="Showing {first} to {last} entries"
    [scrollable]="true" [tableStyle]="{'width.%': 100}" scrollHeight="80vh">
        <ng-template pTemplate="caption">
            <div class="flex align-items-center justify-content-between">
                <div>
                    <h5 class="m-0 primary" >{{'Products Manager'|translate}}</h5>
                    <label class="text-600 ">
                        In total there are <label class="text-primary font-bold ">
                            {{total }}</label> Products .
                    </label>
                </div>
                <div class="table-header inputgroup-stopwords block ">
                    <div class="p-inputgroup inputgroup-stopwords">
                        <div>
                            <button type="button" (click)="showProdSide()" label="{{'Add Product'|translate}}" pRipple pButton
                                icon="pi pi-plus" class="p-button-success "></button>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 30vw" translate>Product Name
                    <p-columnFilter [showApplyButton]="false" [showClearButton]="false"
                    [ngClass]="fillterFildes?.name?.status?'status-filter':null" type="text" field="id"
                    matchMode="equals" display="menu" [showMatchModes]="false" [showOperator]="false"
                    [showAddButton]="false">
                    <ng-template pTemplate="filter">
                        <div class="mt-3">
                            <input [disabled]="fillterFildes?.name?.status" [(ngModel)]="fillterFildes.name.value"
                                type="text" pInputText>
                        </div>
                        <div class="grid mt-2">
                            <div class="col-6">
                                <button pButton label='Clear' class="p-button-outlined"
                                    (click)="fillterFildes.name.value=null;fillterFildes.name.status=flase;clearAllFillter()"
                                    type="button">
                                </button>
                            </div>
                            <div class="col-6">
                                <button pButton [disabled]="!fillterFildes.name.value" label='Apply'
                                    (click)="fillterFildes.name.name='name';fillterFildes.name.status=true;fillterFildes.name.type='$contains';getProducts(1,fillterFildes?.name)"
                                    type="button">
                                </button>
                            </div>
                        </div>
                    </ng-template>
                </p-columnFilter>
            </th>
                <th style="width: 30vw" translate>Stock
                    <p-columnFilter #fitlerstocks [showApplyButton]="false" [showClearButton]="false"
                    [ngClass]="fillterFildes?.stocks?.status?'active-filter':null" type="date"
                    field="stocks" matchMode="equals" display="menu" [showMatchModes]="false"
                    [showOperator]="false" [showAddButton]="false">
                    <ng-template pTemplate="filter">
                        <p-dropdown [disabled]="fillterFildes?.stocks?.status"
                            [options]="queryTypes" [showClear]="true"
                            [(ngModel)]="fillterFildes.stocks.type" placeholder='Select filter Type'
                            optionValue="value" optionLabel="type">
                            <ng-template let-item pTemplate="item">
                                <span>{{item.type}}</span>
                            </ng-template>
                        </p-dropdown>
                        <div class="mt-3">
                            <input [disabled]="fillterFildes?.stocks?.status" [(ngModel)]="fillterFildes.stocks.value"
                            type="text" pInputText>
                        </div>
                        <div class="grid mt-2">
                            <div class="col-6">
                                <button pButton label='Clear' class="p-button-outlined"
                                    (click)="fitlerstocks.overlayVisible=false;fillterFildes.stocks.value=null;fillterFildes.stocks.status=flase;clearAllFillter()"
                                    type="button">
                                </button>
                            </div>
                            <div class="col-6">
                                <button pButton
                                    [disabled]="!fillterFildes.stocks.type||!fillterFildes.stocks.value"
                                    label='Apply'
                                    (click)="fillterFildes.stocks.name='stocks';fillterFildes.stocks.status=true;getProducts(1,fillterFildes?.stocks)"
                                    type="button">
                                </button>

                            </div>
                        </div>
                    </ng-template>

                </p-columnFilter></th>
                <th translate>Price
                    <p-columnFilter #fitlerstocks [showApplyButton]="false" [showClearButton]="false"
                    [ngClass]="fillterFildes?.price?.status?'active-filter':null" type="date"
                    field="price" matchMode="equals" display="menu" [showMatchModes]="false"
                    [showOperator]="false" [showAddButton]="false">
                    <ng-template pTemplate="filter">
                        <p-dropdown [disabled]="fillterFildes?.price?.status"
                            [options]="queryTypes" [showClear]="true"
                            [(ngModel)]="fillterFildes.price.type" placeholder='Select filter Type'
                            optionValue="value" optionLabel="type">
                            <ng-template let-item pTemplate="item">
                                <span>{{item.type}}</span>
                            </ng-template>
                        </p-dropdown>
                        <div class="mt-3">
                            <input [disabled]="fillterFildes?.price?.status" [(ngModel)]="fillterFildes.price.value"
                            type="text" pInputText>
                        </div>
                        <div class="grid mt-2">
                            <div class="col-6">
                                <button pButton label='Clear' class="p-button-outlined"
                                    (click)="fitlerstocks.overlayVisible=false;fillterFildes.price.value=null;fillterFildes.price.status=flase;clearAllFillter()"
                                    type="button">
                                </button>
                            </div>
                            <div class="col-6">
                                <button pButton
                                    [disabled]="!fillterFildes.stocks.type||!fillterFildes.stocks.value"
                                    label='Apply'
                                    (click)="fillterFildes.stocks.name='stocks';fillterFildes.stocks.status=true;getProducts(1,fillterFildes?.stocks)"
                                    type="button">
                                </button>

                            </div>
                        </div>
                    </ng-template>

                </p-columnFilter>
                </th>
                <th translate>Bar Code
                    <p-columnFilter [showApplyButton]="false" [showClearButton]="false"
                        [ngClass]="fillterFildes?.status?.status?'status-filter':null" type="text" field="id"
                        matchMode="equals" display="menu" [showMatchModes]="false" [showOperator]="false"
                        [showAddButton]="false">
                        <ng-template pTemplate="filter">
                            <p-dropdown [disabled]="fillterFildes?.status?.status" [options]="status"
                                [showClear]="true" [(ngModel)]="fillterFildes.status.value"
                                placeholder='Select Status' optionValue="label" optionLabel="label">
                                <ng-template let-item pTemplate="item">
                                    <span [class]="item.label">{{item.label}}</span>
                                </ng-template>
                            </p-dropdown>
                            <div class="grid mt-2">
                                <div class="col-6">
                                    <button pButton label='Clear' class="p-button-outlined"
                                        (click)="fillterFildes.status.value=null;fillterFildes.status.status=flase;clearAllFillter()"
                                        type="button">
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button pButton label='Apply'
                                        (click)="fillterFildes.status.name='status';fillterFildes.status.status=true;fillterFildes.status.type='$eq';getOrders(1,fillterFildes?.status)"
                                        type="button">
                                    </button>
                                </div>
                            </div>
                        </ng-template>
                    </p-columnFilter>
                </th>
                <th translate>Creation Date</th>
                <th style="width: 10% !important" translate>Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-ser let-i="rowIndex">
            <tr>
                <td style="width: 30vw">
                    <span (click)="selectProd(ser)" [class]="ser.attributes.stocks <= 0 ?'text-xl text-danger pointer font-bold':'text-xl text-primary pointer font-bold'">
                        {{ser.attributes.name}}
                    </span>
                </td>
                <td style="width: 30vw">
                    <span  [class]="ser.attributes.stocks <= 0 ?'text-xl text-danger pointer font-bold':'text-xl text-primary pointer font-bold'">
                        {{ser.attributes?.stocks}}
                    </span>
                </td>
                <td>
                    <span class="text-xl text-primary ">
                        {{ser.attributes?.price}} {{jod}}
                    </span>
                </td>
                <td>
                    <span class="text-xl text-primary  bold">
                        <span>{{ser?.attributes?.barcode ? ser?.attributes?.barcode:'ـــ'}}</span>
                    </span>
                </td>
                <td>
                    <span class="text-xl text-primary  bold">
                        {{ ser?.attributes?.createdAt| date: 'dd/MM/yyyy hh:mm' }}
                    </span>
                   
                </td>
                <td style="width: 10%">
                    <button (click)="selectProd(ser)" pButton pRipple icon="pi pi-pencil text-base"
                        class="p-button-sm  p-button-primary mr-1"></button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4">No Orders .</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<app-add-edit-products *ngIf="showProductSidebar" [id]="id" [detailMode]="detailMode" (refreshLish)="getProducts(1,null)" [selectedProduct]="selectedProduct" [(display)]="showProductSidebar"></app-add-edit-products>